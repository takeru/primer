<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
    <title>Primer Test</title>
    <script type="text/javascript" src="../prototype-1.6.0.3.js"></script>
    <script type="text/javascript" src="../jquery-1.3.2.js"     ></script>
    <script type="text/javascript">
      jQuery.noConflict()
      $j = jQuery
      $p = $
    </script>
    <script type="text/javascript" src="../excanvas_r3.compiled.js"></script>
    <script type="text/javascript" src="../matrix.js"              ></script>
    <script type="text/javascript" src="../primer.js"              ></script>

    <script type="text/javascript">
//Mat2D.test()

      jQuery(function() {
        var p1 = new Primer({container:"#div1", debug:true})

        drawZero = function(ctx, color){
          ctx.strokeStyle = color
          ctx.lineWidth = 1
          ctx.beginPath()
          ctx.moveTo( 0, 30)
          ctx.lineTo( 0,  0)
          ctx.lineTo(20,  0)
          ctx.stroke()
        }

        //----------------------------------
        var blue = p1.root.createChild({name:"blue", x:40, y:40,
          draw: function(ctx){
            drawZero(ctx, "#0000ff")
            ctx.fillStyle = "#0000FF"
            ctx.fillRect(0, 0, 50, 50, "hit=rectBlue")
          }
        })

        //----------------------------------
        var red1 = p1.root.createChild({name:"red1", x:200, y:200,
          draw: function(ctx){
            drawZero(ctx, "#FFCCCC")
            ctx.fillStyle = "#FFCCCC"
            ctx.fillRect(2, 2, 45, 5, "hit=rectRed1")
          }
        })

        var red2 = red1.createChild({name:"red2", x:50, y:0,
          draw: function(ctx){
            drawZero(ctx, "#FF6666")
            ctx.fillStyle = "#FF6666"
            ctx.fillRect(2, 2, 45, 5, "hit=rectRed2")
          }
        })

        var red3 = red2.createChild({name:"red3", x:50, y:0,
          draw: function(ctx){
            drawZero(ctx, "#FF0000")
            ctx.fillStyle = "#FF0000"
            ctx.fillRect(2, 2, 45, 5, "hit=rectRed3")

            var xy = [50,0].transform(ctx.currentState().mat2d)
            red3b.x = xy[0]
            red3b.y = xy[1]
          },
          mousemove: function(){
            log("red3:mousemove")
          },
        })

        // for Mat2D test
        var red3b = p1.root.createChild({name:"red3->[50,0]", x:0, y:0,
          draw: function(ctx){
            drawZero(ctx, "#0000cc")
          }
        })


        //----------------------------------
        var green = p1.root.createChild({name:"green", x:10, y:60, fillStyle:"#008800",
          draw: function(ctx){
            drawZero(ctx, "#008800")
            ctx.fillStyle = this.fillStyle
            ctx.fillRect(0, 0, 5+blue.y/2, 10+orange.x/10, "hit=rectGreen")
          }
        })

        //----------------------------------
        var black = p1.root.createChild({name:"black", x:5, y:5, visible:false,
          draw: function(ctx){
            ctx.fillStyle = "#000000"
            ctx.fillRect(0, 0, 30, 10+blue.y, "hit=rectBlack")
            //ctx.strokeRect(0, 0, 10+blue.y, 30)
          }
        })

        //----------------------------------
        var text = p1.root.createChild({name:"text", x:60, y:60,
          draw: function(ctx){
            drawZero(ctx, "#000000")
            ctx.fillText("hello? 123 456 789 abc def", 20, 20, 50, "", "hit=text")
          }
        })

        //----------------------------------
        var orange = blue.createChild({name:"orange", x:30, y:0, fillStyle:"#FF8800",
          draw: function(ctx){
            drawZero(ctx, "#ff8800")
            ctx.lineWidth = 4
            ctx.strokeStyle = "#00FF00"
            ctx.fillStyle = this.fillStyle
            ctx.beginPath()
            ctx.moveTo( 0,  0)
            ctx.lineTo(40,  0)
            ctx.lineTo( 0, 40)
            ctx.fill("hit=fillOrange")
            ctx.stroke()
          },
          mouseover: function(){
            black.visible = true
            orange.fillStyle = "#FF4400"
            green.fillStyle  = "#00FF00"
            p1.redraw()
          },
          mouseout: function(){
            black.visible = false
            orange.fillStyle = "#FF8800"
            green.fillStyle  = "#008800"
            p1.redraw()
          },
        })

        //----------------------------------
        var yellow = orange.createChild({name:"yellow", x:-40, y:80,
          draw: function(ctx){
            drawZero(ctx, "#FFFF00")
            ctx.fillStyle = "#FFFF00"
            ctx.fillRect(0, 0, 20, 20, "hit=rectYellow")
          },
        })

        //----------------------------------
        var dx = 1;
        var dy = 1;
        function go() {
          orange.x += dx
          if(orange.x<=-30){ dx = +3; }
          if(300<=orange.x){ dx = -2; }

          blue.y += dy
          if(blue.y<=0){  dy = +1; }
          if(30<=blue.y){ dy = -2; }

          text.x = orange.x*2
          text.y = 70-blue.y
          yellow.rotation += -3*Math.PI/180

          red1.rotation +=   2*Math.PI/180
          red2.rotation +=  -3*Math.PI/180
          red3.rotation +=  -1*Math.PI/180

          p1.redraw();
        }

        setInterval(go, 150)
        p1.redraw();
      })
    </script>
  </head>

  <body>
    <p>Testing</p>
    <div style="border:5px #333333 solid;">
      <div id="div1" style="width:400px; height:400px; border:5px gray solid;"></div>
    </div>
  </body>
</html>
